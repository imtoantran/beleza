function num2day(e){switch(e){case 1:return"Thứ Hai";case 2:return"Thứ Ba";case 3:return"Thứ Tư";case 4:return"Thứ Năm";case 5:return"Thứ Sáu";case 6:return"Thứ Bảy";case 7:return"Chủ Nhật";default:return""}}var dates={convert:function(e){return e.constructor===Date?e:e.constructor===Array?new Date(e[0],e[1],e[2]):e.constructor===Number?new Date(e):e.constructor===String?new Date(e):"object"==typeof e?new Date(e.year,e.month,e.date):0/0},compare:function(e,t){return isFinite(e=this.convert(e).valueOf())&&isFinite(t=this.convert(t).valueOf())?(e>t)-(t>e):0/0},inRange:function(e,t,n){return isFinite(e=this.convert(e).valueOf())&&isFinite(t=this.convert(t).valueOf())&&isFinite(n=this.convert(n).valueOf())?e>=t&&n>=e:0/0}},ClientReport=function(){var e=$("#reportClients_table"),t=function(){var t="<tr><td>:client_name</td><td>:client_phone</td><td>:client_email</td><td>:client_birth</td><td>:client_sex</td><td>:client_note</td></tr>",n=URL+"spaCMS/reports/xhrGet_client_report",a="";$.get(n,function(n){$.each(n,function(n,o){a=t.replace(":client_name",o.client_name),a=a.replace(":client_phone",o.client_phone),a=a.replace(":client_email",o.client_email),a=a.replace(":client_birth",moment(o.client_birth,"YYYY-MM-DD").format("DD-MM-YYYY")),a=a.replace(":client_sex",0==o.client_sex?"Nữ":"Nam"),a=a.replace(":client_note",o.client_note),e.find("tbody").append(a)})},"json").done(function(){e.dataTable({aaSorting:[[0,"asc"]],aoColumns:[{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0}],aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Tất cả"]],iDisplayLength:10,sPaginationType:"bootstrap",oLanguage:{oPaginate:{sPrevious:"Prev",sNext:"Next"},sZeroRecords:"Không có dữ liệu nào cả.",sSearch:"Tìm kiếm: ",sLengthMenu:"Hiển thị &nbsp;&nbsp; _MENU_ &nbsp;&nbsp; dòng.",sInfo:"Hiển thị _START_ đến _END_ của _TOTAL_ dòng.",sInfoEmpty:"Hiển thị 0 đến 0 của 0 dòng."}}),jQuery("#reportClients_table_wrapper .dataTables_filter input").addClass("form-control input-medium input-inline"),jQuery("#reportClients_table_wrapper .dataTables_length select").addClass("form-control input-xsmall"),jQuery("#reportClients_table_wrapper .dataTables_length select").select2()})},n=function(){var e=$("#clients_reports_export_excel");e.on("click",function(){var e=URL+"spaCMS/reports/xhrGet_client_report_export_excel";window.open(e,"Download")})};return{init:function(){t(),n()}}}(),BookingReport=function(){var e=$("#listOfBooking_table"),t=function(){var t=e.find("tbody"),n="<tr><td>:booking_id</td><td>:client_name</td><td>:user_service_name</td><td>:booking_detail_price đ</td><td>:booking_detail_date</td><td>:bd_date_sort</td><td>:booking_detail_is_confirm</td><td>:booking_detail_status</td></tr>",a='<span class="label label-sm label-default">Chưa hoàn thành</span>',o='<span class="label label-sm label-success">Hoàn thành</span>',r='<span class="label label-sm label-danger">Hủy</span>',i='<span class="label label-sm label-danger">Chưa xác thực</span>',l='<span class="label label-sm label-success">Xác thực</span>',s=URL+"spaCMS/reports/xhrGet_booking_report",c="";$.get(s,function(e){$.each(e,function(e,s){c=n.replace(":booking_id",s.booking_id),c=c.replace(":client_name",s.client_name),c=c.replace(":user_service_name",s.user_service_name),c=c.replace(":booking_detail_price",$.number(s.booking_detail_price)),c=c.replace(":booking_detail_date",moment(s.booking_detail_date,"YYYY-MM-DD").format("DD/MM/YYYY")),c=c.replace(":bd_date_sort",moment(s.booking_detail_date,"YYYY-MM-DD").format("YYYYMMDD")),c=c.replace(":booking_detail_is_confirm",0==s.booking_detail_is_confirm?i:l),c=c.replace(":booking_detail_status",0==s.booking_detail_status?a:1==s.booking_detail_status?o:r),t.append(c)})},"json").done(function(){e.dataTable({aaSorting:[[5,"desc"]],aoColumns:[{bSortable:!0},{bSortable:!0},{bSortable:!0},null,null,{bVisible:!1},{bSortable:!0},{bSortable:!0}],aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Tất cả"]],iDisplayLength:10,sPaginationType:"bootstrap",oLanguage:{oPaginate:{sPrevious:"Prev",sNext:"Next"},sZeroRecords:"Không có dữ liệu nào cả.",sSearch:"Tìm kiếm: ",sLengthMenu:"Hiển thị &nbsp;&nbsp; _MENU_ &nbsp;&nbsp; dòng.",sInfo:"Hiển thị _START_ đến _END_ của _TOTAL_ dòng.",sInfoEmpty:"Hiển thị 0 đến 0 của 0 dòng."}}),jQuery("#listOfBooking_table_wrapper .dataTables_filter input").addClass("form-control input-medium input-inline"),jQuery("#listOfBooking_table_wrapper .dataTables_length select").addClass("form-control input-xsmall"),jQuery("#listOfBooking_table_wrapper .dataTables_length select").select2()})},n=function(){var e=$("#bookings_reports_export_excel");e.on("click",function(){var e=URL+"spaCMS/reports/xhrGet_booking_report_export_excel";window.open(e,"Download")})};return{init:function(){t(),n()}}}(),EvoucherReport=function(){var e=$("#listOfEvoucher_table"),t=function(){var t=e.find("tbody"),n="<tr><td>:booking_id</td><td>:client_name</td><td>:user_service_name</td><td>:evoucher_price đ</td><td>:booking_date :status_new</td><td>:b_date_sort</td><td>:evoucher_due_date :status_expires</td><td>:evoucher_status</td></tr>",a='<span class="label label-sm label-default">Chưa sử dụng</span>',o='<span class="label label-sm label-success">Đã sử dụng</span>',r='<span class="label label-sm label-danger">Hết hạn</span>',i='<span class="label label-sm label-danger">Mới</span>',l=moment().format("YYYY-MM-DD"),s=moment().subtract("days",1).format("YYYY-MM-DD"),c=null,p=null,d=URL+"spaCMS/reports/xhrGet_evoucher_report",_="";$.get(d,function(e){e.length>0&&$.each(e,function(e,d){_=n.replace(":booking_id",d.booking_id),_=_.replace(":client_name",d.client_name),_=_.replace(":user_service_name",d.user_service_name),_=_.replace(":evoucher_price",$.number(d.e_voucher_price)),_=_.replace(":booking_date",moment(d.booking_date,"YYYY-MM-DD").format("DD/MM/YYYY")),_=_.replace(":b_date_sort",moment(d.booking_date,"YYYY-MM-DD").format("YYYYMMDD")),p=d.booking_date,_=0==dates.compare(l,p)||0==dates.compare(s,p)?_.replace(":status_new",i):_.replace(":status_new",""),_=_.replace(":evoucher_due_date",moment(d.e_voucher_due_date,"YYYY-MM-DD").format("DD/MM/YYYY")),c=d.e_voucher_due_date,_=1==dates.compare(l,c)?_.replace(":status_expires",r):_.replace(":status_expires",""),_=_.replace(":evoucher_status",0==d.e_voucher_status?a:o),t.append(_)})},"json").done(function(){e.dataTable({aaSorting:[[5,"desc"]],aoColumns:[{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bSortable:!0},{bVisible:!1},{bSortable:!0},{bSortable:!0}],aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Tất cả"]],iDisplayLength:10,sPaginationType:"bootstrap",oLanguage:{oPaginate:{sPrevious:"Prev",sNext:"Next"},sZeroRecords:"Không có dữ liệu nào cả.",sSearch:"Tìm kiếm: ",sLengthMenu:"Hiển thị &nbsp;&nbsp; _MENU_ &nbsp;&nbsp; dòng.",sInfo:"Hiển thị _START_ đến _END_ của _TOTAL_ dòng.",sInfoEmpty:"Hiển thị 0 đến 0 của 0 dòng."}}),jQuery("#listOfEvoucher_table_wrapper .dataTables_filter input").addClass("form-control input-medium input-inline"),jQuery("#listOfEvoucher_table_wrapper .dataTables_length select").addClass("form-control input-xsmall"),jQuery("#listOfEvoucher_table_wrapper .dataTables_length select").select2()})},n=function(){var e=$("#evouchers_reports_export_excel");e.on("click",function(){var e=URL+"spaCMS/reports/xhrGet_evoucher_report_export_excel";window.open(e,"Download")})};return{init:function(){t(),n()}}}(),AppointmentReport=function(){var e=$("#listOfAppointment_table"),t=function(){var t=e.find("tbody"),n="<tr><td>:appointment_id</td><td>:appointment_client_name</td><td>:user_service_name</td><td>:appointment_price đ</td><td>:appointment_date</td><td>:app_date_sort</td><td>:appointment_is_confirm</td><td>:appointment_status</td></tr>",a='<span class="label label-sm label-default">Chưa hoàn thành</span>',o='<span class="label label-sm label-success">Hoàn thành</span>',r='<span class="label label-sm label-danger">Hủy</span>',i='<span class="label label-sm label-danger">Chưa xác thực</span>',l='<span class="label label-sm label-success">Xác thực</span>',s=URL+"spaCMS/reports/xhrGet_appointment_report",c="";$.get(s,function(e){$.each(e,function(e,s){c=n.replace(":appointment_id",s.appointment_id),c=c.replace(":appointment_client_name",s.appointment_client_name),c=c.replace(":user_service_name",s.user_service_name),c=c.replace(":appointment_price",$.number(s.appointment_price)),c=c.replace(":appointment_date",moment(s.appointment_date,"YYYY-MM-DD").format("DD/MM/YYYY")),c=c.replace(":app_date_sort",moment(s.appointment_date,"YYYY-MM-DD").format("YYYYMMDD")),c=c.replace(":appointment_is_confirm",0==s.appointment_is_confirm?i:l),c=c.replace(":appointment_status",0==s.appointment_status?a:1==s.appointment_status?o:r),t.append(c)})},"json").done(function(){e.dataTable({aaSorting:[[5,"desc"]],aoColumns:[{bSortable:!0},{bSortable:!0},{bSortable:!0},null,null,{bVisible:!1},{bSortable:!0},{bSortable:!0}],aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Tất cả"]],iDisplayLength:10,sPaginationType:"bootstrap",oLanguage:{oPaginate:{sPrevious:"Prev",sNext:"Next"},sZeroRecords:"Không có dữ liệu nào cả.",sSearch:"Tìm kiếm: ",sLengthMenu:"Hiển thị &nbsp;&nbsp; _MENU_ &nbsp;&nbsp; dòng.",sInfo:"Hiển thị _START_ đến _END_ của _TOTAL_ dòng.",sInfoEmpty:"Hiển thị 0 đến 0 của 0 dòng."}}),jQuery("#listOfAppointment_table_wrapper .dataTables_filter input").addClass("form-control input-medium input-inline"),jQuery("#listOfAppointment_table_wrapper .dataTables_length select").addClass("form-control input-xsmall"),jQuery("#listOfAppointment_table_wrapper .dataTables_length select").select2()})},n=function(){var e=$("#appointments_reports_export_excel");e.on("click",function(){var e=URL+"spaCMS/reports/xhrGet_appointment_report_export_excel";window.open(e,"Download")})};return{init:function(){t(),n()}}}(),GiftvoucherReport=function(){var e=$("#listOfGiftvoucher_table"),t=function(){var t=e.find("tbody"),n="<tr><td>:gift_voucher_id</td><td>:gift_voucher_code</td><td>:client_name</td><td>:gift_voucher_message</td><td>:gift_voucher_price đ</td><td>:gift_voucher_updated</td><td>:gv_update_sort</td><td>:gift_voucher_type</td></tr>",a=URL+"spaCMS/reports/xhrGet_giftvoucher_report",o="";$.get(a,function(e){jQuery.isEmptyObject(e)||$.each(e,function(e,a){o=n.replace(":gift_voucher_id",a.gift_voucher_id),o=o.replace(":gift_voucher_code",a.gift_voucher_code),o=o.replace(":client_name",a.client_name),o=o.replace(":gift_voucher_price",$.number(a.gift_voucher_price)),o=o.replace(":gift_voucher_updated",moment(a.gift_voucher_updated,"YYYY-MM-DD HH:mm:ss").format("DD/MM/YYYY HH:mm:ss")),o=o.replace(":gv_update_sort",moment(a.gift_voucher_updated,"YYYY-MM-DD HH:mm:ss").format("YYYYMMDD")),o=o.replace(":gift_voucher_message",a.gift_voucher_message),o=o.replace(":gift_voucher_type",1==a.gift_voucher_type?"Gửi mail":"Gửi thiệp"),t.append(o)})},"json").done(function(){e.dataTable({aaSorting:[[6,"desc"]],aoColumns:[{bSortable:!0},{bSortable:!0},{bSortable:!0},null,null,null,{bVisible:!1},null],aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Tất cả"]],iDisplayLength:10,sPaginationType:"bootstrap",oLanguage:{oPaginate:{sPrevious:"Prev",sNext:"Next"},sZeroRecords:"Không có dữ liệu nào cả.",sSearch:"Tìm kiếm: ",sLengthMenu:"Hiển thị &nbsp;&nbsp; _MENU_ &nbsp;&nbsp; dòng.",sInfo:"Hiển thị _START_ đến _END_ của _TOTAL_ dòng.",sInfoEmpty:"Hiển thị 0 đến 0 của 0 dòng."}}),jQuery("#listOfGiftvoucher_table_wrapper .dataTables_filter input").addClass("form-control input-medium input-inline"),jQuery("#listOfGiftvoucher_table_wrapper .dataTables_length select").addClass("form-control input-xsmall"),jQuery("#listOfGiftvoucher_table_wrapper .dataTables_length select").select2()})},n=function(){var e=$("#giftvouchers_reports_export_excel");e.on("click",function(){var e=URL+"spaCMS/reports/xhrGet_giftvoucher_report_export_excel";window.open(e,"Download")})};return{init:function(){t(),n()}}}(),SaleReport=function(){var e=function(){$("#dashboard-report-range").daterangepicker({opens:App.isRTL()?"right":"left",startDate:moment().subtract("days",7),endDate:moment(),minDate:"01/01/2012",maxDate:"12/31/2099",dateLimit:{days:60},showDropdowns:!1,showWeekNumbers:!1,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{"Hôm nay":[moment(),moment()],"Hôm qua":[moment().subtract("days",1),moment().subtract("days",1)],"7 Ngày trước":[moment().subtract("days",6),moment()],"30 Ngày trước":[moment().subtract("days",29),moment()],"Tháng này":[moment().startOf("month"),moment().endOf("month")],"Tháng trước":[moment().subtract("month",1).startOf("month"),moment().subtract("month",1).endOf("month")]},buttonClasses:["btn"],applyClass:"blue",cancelClass:"default",format:"DD/MM/YYYY",separator:" to ",locale:{applyLabel:"Chọn",fromLabel:"Từ",toLabel:"Đến",customRangeLabel:"Tùy chọn",daysOfWeek:["CN","T2","T3","T4","T5","T6","T7"],monthNames:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],firstDay:1}},function(e,t){var n=$(".printed-date").find(".date");n.text(moment().format("DD/MM/YYYY HH:mm"));var a=$("#sales_booking"),o=$("#sales_evoucher"),r=a.find(".sale_report_by_service_group").find("tbody"),i=a.find(".sale_report_top_service").find("tbody"),l=o.find(".sale_report_by_service_group").find("tbody"),s=o.find(".sale_report_top_service").find("tbody");r.html(""),i.html(""),l.html(""),s.html(""),$("#dashboard-report-range span").html(e.format("DD/MM/YYYY")+" - "+t.format("DD/MM/YYYY")),$(".important").find(".date").html(e.format("DD/MM/YYYY")+" - "+t.format("DD/MM/YYYY"));var c="<tr><td>:name</td><td>:value đ</td><td>:count</td></tr>",p="",d=e.format("YYYY-MM-DD"),_=t.format("YYYY-MM-DD");$("#sales_reports_export_pdf").attr("data-from",d),$("#sales_reports_export_pdf").attr("data-to",_);var u=URL+"spaCMS/reports/xhrGet_sale_report";$.get(u,{from:d,to:_},function(e){jQuery.isEmptyObject(e)||($(".totalSale_value").text(e.totalSale.value+" đ"),$(".totalSale_count").text(e.totalSale.count),jQuery.isEmptyObject(e.groupServiceSaleBooking)||$.each(e.groupServiceSaleBooking,function(e,t){p=c.replace(":name",t.name),p=p.replace(":value",t.value),p=p.replace(":count",t.count),r.append(p)}),jQuery.isEmptyObject(e.topServiceSaleBooking)||$.each(e.topServiceSaleBooking,function(e,t){p=c.replace(":name",t.name),p=p.replace(":value",t.value),p=p.replace(":count",t.count),i.append(p)}),jQuery.isEmptyObject(e.groupServiceSaleEvoucher)||$.each(e.groupServiceSaleEvoucher,function(e,t){p=c.replace(":name",t.name),p=p.replace(":value",t.value),p=p.replace(":count",t.count),l.append(p)}),jQuery.isEmptyObject(e.topServiceSaleEvoucher)||$.each(e.topServiceSaleEvoucher,function(e,t){p=c.replace(":name",t.name),p=p.replace(":value",t.value),p=p.replace(":count",t.count),s.append(p)}))},"json")}),$("#dashboard-report-range span").html(moment().subtract("days",6).format("DD/MM/YYYY")+" - "+moment().format("DD/MM/YYYY")),$("#dashboard-report-range").show(),$("#sales-tab").on("click",function(){$(".daterangepicker .ranges ul li:nth-child(3)").click()}),$(".daterangepicker .ranges ul li:nth-child(1)").on("click",function(){$(".period").text(num2day(moment().weekday()))}),$(".daterangepicker .ranges ul li:nth-child(2)").on("click",function(){$(".period").text(num2day(moment().subtract("day",1).weekday()))}),$(".daterangepicker .ranges ul li:nth-child(3)").on("click",function(){$(".period").text("7 NGÀY")}),$(".daterangepicker .ranges ul li:nth-child(4)").on("click",function(){$(".period").text("30 NGÀY")}),$(".daterangepicker .ranges ul li:nth-child(5)").on("click",function(){$(".period").text("THÁNG "+(moment().month()+1))}),$(".daterangepicker .ranges ul li:nth-child(6)").on("click",function(){$(".period").text("THÁNG "+(moment().subtract("month",1).month()+1))}),$(".daterangepicker .ranges .applyBtn").on("click",function(){$(".period").text("")})},t=function(){var e=$("#sales_reports_export_pdf");e.on("click",function(){var e=$(this),t=$(".period").text(),n=e.attr("data-from"),a=e.attr("data-to");console.log(n);var o=URL+"spaCMS/reports/xhrGet_sales_report_export_pdf?from="+n+"&to="+a+"&period="+t;window.open(o,"Download")})};return{init:function(){e(),t()}}}();$(document).ready(function(){ClientReport.init(),BookingReport.init(),EvoucherReport.init(),AppointmentReport.init(),GiftvoucherReport.init(),SaleReport.init()});