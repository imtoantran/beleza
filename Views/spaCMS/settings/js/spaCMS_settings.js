function get_day_vi(e){switch(e){case"2":return"Thứ 2";case"3":return"Thứ 3";case"4":return"Thứ 4";case"5":return"Thứ 5";case"6":return"Thứ 6";case"7":return"Thứ 7";case"8":return"Chủ nhật";default:return!1}}function setTimeAutoConfirm(e){var n=$("#booking-settings-onlineBookingMinHours"),t=$("#booking-settings-autoConfirm"),i=$("#booking-settings-autoConfirm option");parseInt(n.val())<parseInt(t.val())?(alert("Thời gian tối thiểu phải lớn hơn thời gian tự động xác thực. Xin vui lòng điều chỉnh lại."),n.val(e)):i.each(function(){parseInt($(this).val())>parseInt(n.val())?($(this).prop({disabled:"true"}),$(this).css("color","red")):($(this).removeAttr("disabled"),$(this).css("color","green").attr("cursor","pointer"))})}$("#venue_name, #venue_type, #venue_location_1, #venue_location_2, #venue_address, #loc_map, #phone, #email, #website, #face, #google, #description").tooltip({placement:"right",html:!0,container:"body"});var ImageManager=function(){return{init:function(){$("#iM_user_logo").click(function(){$("#imageManager_saveChange").attr("cover_id","user_logo")}),$("#iM_user_slide").click(function(){$("#imageManager_saveChange").attr("cover_id","user_slide")}),$("#imageManager_saveChange").on("click",function(e){e.preventDefault();var n=$(this).attr("cover_id"),t=$("input:radio[name='iM-radio']:checked"),i=t.val(),a=t.attr("data-image");if("user_slide"==n){var s=null,o=$("div.list_user_slide"),r='<li class="single-picture">';r+='<div class="single-picture-wrapper">',r+='<img id="user_slide_thumbnail" src=":img_thumbnail">',r+='<input type="hidden" name="user_slide[]" value=":user_slide_val">',r+="</div>",r+='<div class="del_image icons-delete2"></div>',r+="</li>",s=r.replace(":img_thumbnail",a),s=s.replace(":user_slide_val",i),o.append(s),$(".del_image").on("click",function(){var e=$(this).parent();e.attr("disabled","disabled"),e.fadeOut()})}else $("#"+n+"_thumbnail").attr("src",a),$("input[name="+n+"]").val(i);$("#imageManager_modal").modal("hide")})}}}(),UserDetail=function(){var e=function(){var e=URL+"spaCMS/settings/xhrGet_city",n="",t=$.get(e,function(e){$.each(e,function(e,t){n+='<option value="'+t.city_id+'">'+t.city_name+"</option>"}),$("#user_city_id").append(n)},"json");return t},n=function(e){$("#user_district_id").html('<option value="0">Chưa chọn</option>');var n=URL+"spaCMS/settings/xhrGet_district",t="",i=$.get(n,{city_id:e},function(e){$.each(e,function(e,n){t+='<option value="'+n.district_id+'">'+n.district_name+"</option>"}),$("#user_district_id").append(t)},"json");return i},t=function(){var t=URL+"spaCMS/settings/xhrGet_user_detail";$.get(t,function(t){if(""!=t[0].user_logo)var i=get_thumbnail(t[0].user_logo,user_id);$("#user_logo_thumbnail").attr("src",i),$("input[name=user_logo]").val(t[0].user_logo),$("input[name=user_business_name]").val(t[0].user_business_name),$("textarea[name=user_address]").val(t[0].user_address),$("input[name=user_phone]").val(t[0].user_phone),$("input[name=user_facebook]").val(t[0].user_facebook),$("input[name=user_website]").val(t[0].user_website),$("input[name=user_googleplus]").val(t[0].user_googleplus),$("input[name=user_email]").val(t[0].user_email),$("textarea[name=user_description]").val(t[0].user_description),$("input[name=user_type_business]").val(t[0].user_type_business),e().always(function(){$("select[name=user_city_id]").find('option[value="'+t[0].user_city_id+'"]').prop("selected",!0),n(t[0].user_city_id).always(function(){$("select[name=user_district_id]").find('option[value="'+t[0].user_district_id+'"]').prop("selected",!0)}),$("#user_city_id").find("option").on("click",function(){var e=$(this).val();n(e).always(function(){$("select[name=user_district_id]").find('option[value="'+t[0].user_district_id+'"]').prop("selected",!0)})})})},"json").done(function(){var e=$("#user_address").val();$("#address_for_find").val(e)})},i=function(){$("#user_detail_form").on("submit",function(){var e=$(this).serialize(),n=!1,t=$(this).find(".loading"),i=$(this).find(".done");t.fadeIn(),i.hide();var a=URL+"spaCMS/settings/xhrUpdate_user_detail";return $.post(a,e,function(e){1==e.success&&(n=!0)},"json").done(function(){t.hide(),i.show(),alert(n?"Cập nhật thành công!":"Update user detail error!")}),!1})},a=function(){var e=URL+"spaCMS/settings/xhrGet_user_is_use_voucher";$.get(e,function(e){e?$("input[name=user_is_use_voucher]").attr("checked",!0):$("input[name=user_is_use_voucher]").attr("checked",!1)},"json")},s=function(){$("#user_is_use_voucher_form").on("submit",function(){var e=$(this).serialize(),n=$(this).find(".loading"),t=$(this).find(".done");n.fadeIn(),t.hide();var i=URL+"spaCMS/settings/xhrUpdate_user_is_use_voucher";return $.post(i,e,function(){n.fadeOut(),t.fadeIn()},"json"),!1})},o=function(){var e=URL+"spaCMS/settings/xhrGet_user_slide",n='<li class="single-picture">';n+='<div class="single-picture-wrapper">',n+='<img id="user_slide_thumbnail" src=":img_thumbnail">',n+='<input type="hidden" name="user_slide[]" value=":user_slide_val">',n+="</div>",n+='<div class="del_image icons-delete2"></div>',n+="</li>";var t=null,i=null,a=$("div.list_user_slide");$.get(e,function(e){if("undefined"!=typeof e){t=e[0].user_slide.split(",");for(var s=0;s<t.length;s++){var o=get_thumbnail(t[s],user_id);i=n.replace(":img_thumbnail",o),i=i.replace(":user_slide_val",t[s]),a.append(i)}}$(".del_image").on("click",function(){var e=$(this).parent();e.fadeOut(),e.html("")})},"json")},r=$("#loc_map"),u=function(){var e=$("input[name=user_lat]",r),n=$("input[name=user_long]",r),t=$("#staticmap_img"),i=URL+"spaCMS/settings/xhrGet_user_map",a="https://maps.googleapis.com/maps/api/staticmap?sensor=false&zoom=15&size=397x208&maptype=roadmap&markers=%7C:user_lat%2C:user_long";$.get(i,function(i){a=a.replace(":user_lat",i.user_lat),a=a.replace(":user_long",i.user_long),t.attr("src",a),e.val(i.user_lat),n.val(i.user_long)},"json")},c=$("#venueDetailsMap_modal"),l=function(){var e=$("#btnOM_editUserMap"),n=$("input[name=user_lat]",c),t=$("input[name=user_long]",c);google.maps.event.addDomListener(window,"load",function(){e.on("click",function(){c.modal("show");var e=$("input[name=user_lat]",r).val(),i=$("input[name=user_long]",r).val();n.val(e),t.val(i);var a,s,o=new google.maps.LatLng(e,i),u={zoom:15,center:o};return s=new google.maps.Map(document.getElementById("venue-details-map-container"),u),a=new google.maps.Marker({map:s,draggable:!0,animation:google.maps.Animation.DROP,position:o,icon:URL+"public/assets/img/map-marker.png"}),google.maps.event.addListener(a,"dragend",function(){n.val(this.getPosition().lat()),t.val(this.getPosition().lng())}),!1})})},_=function(){$("#btnAct_find_address_on_map").on("click",function(){var e=$("#address_for_find").val(),n=$("input[name=user_lat]",c),t=$("input[name=user_long]",c),i=null,a=null,s="https://maps.googleapis.com/maps/api/geocode/json?address="+e+",Vietnam";return $.get(s,function(e){if("OK"==e.status){i=e.results[0].geometry.location.lat,a=e.results[0].geometry.location.lng;var s,o,r=new google.maps.LatLng(i,a),u={zoom:15,center:r};o=new google.maps.Map(document.getElementById("venue-details-map-container"),u),s=new google.maps.Marker({map:o,draggable:!0,animation:google.maps.Animation.DROP,position:r,icon:URL+"public/assets/img/map-marker.png"}),google.maps.event.addListener(s,"dragend",function(){n.val(this.getPosition().lat()),t.val(this.getPosition().lng())})}else jAlert("Không tìm thấy địa chỉ nào phù hợp!")},"json").done(function(){n.val(i),t.val(a)}),!1})},d=function(){eUM_form=$("#editUserMap_form"),eUM_form.on("submit",function(){var e=$(this),n=e.serialize(),t=!1,i=e.find(".done"),a=e.find(".loading");i.hide(),a.fadeIn();var s=URL+"spaCMS/settings/xhrUpdate_user_map";return $.post(s,n,function(e){"success"==e&&(u(),t=!0)}).done(function(){i.show(),a.hide(),t?c.modal("hide"):alert("Update location error! ")}),!1})};return{init:function(){t(),i(),a(),s(),o(),u(),l(),d(),_()}}}(),UserOpenHour=function(){var e=function(){var e=URL+"spaCMS/settings/xhrGet_user_open_hour";$.get(e,function(e){var n=null,t=null,i=null,a=null,s="",o="",r='<li class=":status">';r+="<div>",r+='<input class="user_open_hour_checked" type="checkbox" :checked id=":day">',r+='<label for=":day">:vi_day</label>',r+='<select :disabled name="user_open_hour_from[:day]">',r+=":option_open_hour",r+="</select> - ",r+='<select :disabled name="user_open_hour_to[:day]">',r+=":option_close_hour",r+="</select>",r+="</div>",r+="</li>";var u=$("#opening-hours ul.week");$.each(e,function(e,c){var l=get_day_vi(e),_=c[1],d=c[2];s="",o="",0==c[0]?(n="off",t="",i='disabled="disabled"'):(n="on",t='checked="checked"',i="");var p=r.replace(":status",n);p=p.replace(/:checked/g,t),p=p.replace(/:disabled/g,i),p=p.replace(/:day/g,e),p=p.replace(/:vi_day/g,l);for(var m=0;24>m;m++)a=m==_?'selected="selected"':null,10>m&&(s+="<option "+a+' value="'+m+'">0'+m+":00</option>"),m>10&&(s+="<option "+a+' value="'+m+'">'+m+":00</option>");for(var m=0;24>m;m++)a=m==d?'selected="selected"':null,10>m&&(o+="<option "+a+' value="'+m+'">0'+m+":00</option>"),m>10&&(o+="<option "+a+' value="'+m+'">'+m+":00</option>");p=p.replace(":option_open_hour",s),p=p.replace(":option_close_hour",o),u.append(p)}),$(".user_open_hour_checked").change(function(){if($(this).is(":checked")){var e=$(this).parent().parent();e.removeClass("off"),e.addClass("on"),e.find("select").removeAttr("disabled")}else{var e=$(this).parent().parent();e.removeClass("on"),e.addClass("off"),e.find("select").attr("disabled","disabled")}})},"json")},n=function(){$("#user_open_hour_form").on("submit",function(){var e=$(this).serialize(),n=$(this).find(".loading"),t=$(this).find(".done");n.fadeIn(),t.hide();var i=URL+"spaCMS/settings/xhrUpdate_user_open_hour";return $.post(i,e,function(){n.fadeOut(),t.fadeIn()},"json"),!1})};return{init:function(){e(),n()}}}(),UserFinance=function(){var e=function(){var e=URL+"spaCMS/settings/xhrGet_country",n="",t=$.get(e,function(e){$.each(e,function(e,t){n+='<option value="'+t.country_id+'">'+t.country_name+"</option>"}),$("#user_country_id").html(n),$("#user_company_country_id").html(n)},"json");return t},n=function(){var n=URL+"spaCMS/settings/xhrGet_user_company";$.get(n,function(n){n.length>0&&($("input[name=user_company_name]").val(n[0].user_company_name),$("input[name=user_company_delegate]").val(n[0].user_company_delegate),$("textarea[name=user_company_address]").val(n[0].user_company_address),$("input[name=user_company_tax_code]").val(n[0].user_company_tax_code),e().done(function(){$("select[name=user_company_country_id]").find('option[value="'+n[0].user_company_country_id+'"]').prop("selected",!0)}),$("input[name=user_contact_name]").val(n[0].user_contact_name),$("input[name=user_contact_email]").val(n[0].user_contact_email),$("input[name=user_contact_phone]").val(n[0].user_contact_phone),$("input[name=user_contact_role]").val(n[0].user_contact_role))},"json")},t=function(){$("#user_company_form").on("submit",function(){var e=$(this).serialize(),n=!1,t=$(this).find(".loading"),i=$(this).find(".done");t.fadeIn(),i.hide();var a=URL+"spaCMS/settings/xhrUpdate_user_company";return $.get(a,e,function(e){"success"==e&&(n=!0)}).done(function(){t.hide(),i.show(),alert(n?"Cập nhật thành công!":"Update finance error!")}),!1})},i=function(){var e=URL+"spaCMS/settings/xhrGet_user_bank_acc";$.get(e,function(e){$("input[name=user_bank_acc_owner]").val(e[0].user_bank_acc_owner),$("input[name=user_bank_acc]").val(e[0].user_bank_acc),$("textarea[name=user_bank_address]").val(e[0].user_bank_address),$("input[name=user_bank_branch]").val(e[0].user_bank_branch),$("input[name=user_bank_name]").val(e[0].user_bank_name)},"json")},a=function(){$("#user_bank_acc_form").on("submit",function(){var e=$(this).serialize(),n=$(this).find(".loading"),t=$(this).find(".done");n.fadeIn(),t.hide();var i=URL+"spaCMS/settings/xhrUpdate_user_bank_acc";return $.get(i,e,function(){n.fadeOut(),t.fadeIn()},"json"),!1})};return{init:function(){n(),t(),i(),a()}}}(),UserNotification=function(){var e=$("#user_notification_form"),n=$("input[name=user_notification_email]",e),t=function(){var e=URL+"spaCMS/settings/xhrGet_user_notification_email";$.get(e,function(e){n.val(e[0].user_notification_email)},"json").done(function(){})},i=function(){e.on("submit",function(e){e.preventDefault();var t=$(this),i=n.val(),a=!1,s=t.find(".loading"),o=t.find(".done");s.fadeIn(),o.hide();var r=URL+"spaCMS/settings/xhrUpdate_user_notification";$.post(r,{user_notification_email:i},function(e){"success"==e&&(a=!0)}).done(function(){s.hide(),o.show(),alert(a?"Cập nhật thành công!":"Update Email notification error!")})})};return{init:function(){t(),i()}}}(),OnlineBooking=function(){var e=$("#editOBs_form"),n=function(){e.on("submit",function(e){e.preventDefault();var n=$(this),t=n.serialize(),i=!1,a=n.find(".loading"),s=n.find(".done");a.fadeIn(),s.hide();var o=URL+"spaCMS/settings/xhrUpdate_online_booking";return $.post(o,t,function(e){"success"==e&&(i=!0)}).done(function(){a.hide(),s.show(),alert(i?"Cập nhật thành công!":"Update Online Booking error!")}),!1})},t=function(){var n=$("input[name=user_is_use_gvoucher]",e),t=URL+"spaCMS/settings/xhrGet_user_is_use_gvoucher";$.get(t,function(e){1==e.user_is_use_gvoucher?n.prop("checked",!0):n.prop("checked",!1)},"json")},i=function(){var n=$("input[name=user_is_use_evoucher]",e),t=URL+"spaCMS/settings/xhrGet_user_is_use_evoucher";$.get(t,function(e){1==e.user_is_use_evoucher?n.prop("checked",!0):n.prop("checked",!1)},"json")},a=function(){var n=$("input[name=user_is_use_appointment]",e),t=URL+"spaCMS/settings/xhrGet_user_is_use_appointment";$.get(t,function(e){1==e.user_is_use_appointment?n.prop("checked",!0):n.prop("checked",!1)},"json")},s=function(){var n=$("input[name=user_limit_before_booking]",e),t=$("select[name=user_limit_before_service]",e),i=$("select[name=user_limit_auto_confirm]",e);$.ajax({url:URL+"spaCMS/settings/xhrGet_user_limit_before_booking",dataType:"json"}).done(function(e){null!=e&&(n.val(e.user_limit_before_booking),t.find('option[value="'+e.user_limit_before_service+'"]').prop("selected",!0),i.find('option[value="'+e.user_limit_auto_confirm+'"]').prop("selected",!0))}).fail(function(){console.log("error")}).always(function(){var e=$("#booking-settings-onlineBookingMinHours"),n=e.attr("data-time-before-service"),t=e.find("option");t.each(function(){parseInt($(this).val())<=n&&($(this).prop({disabled:"true"}),$(this).css("color","red"))})})};return{init:function(){t(),i(),a(),s(),n()}}}(),Sercurity=function(){var e=$("#security_password_form"),n=function(){e.on("submit",function(n){n.preventDefault();var t=$(this),i=$("input[name=user_password]").val(),a=$("input[name=user_password_new]").val(),s=$("input[name=user_password_new_confirm]").val(),o=!1,r=!1,u=t.find(".loading"),c=t.find(".done"),l=$(".warning_notmatch"),_=$(".warning_error");if(l.hide(),_.hide(),u.fadeIn(),c.hide(),a==s){var d=URL+"spaCMS/settings/xhrUpdate_user_password";$.post(d,{user_password:i,user_password_new:a},function(e){return"password_error"==e?(o=!0,!1):void("success"==e&&(r=!0))}).done(function(){r?(e[0].reset(),alert("Cập nhật thành công!")):o?_.fadeIn():alert("Update Password error!")})}else l.fadeIn();u.hide(),c.show()})};return{init:function(){n()}}}();$(document).ready(function(){UserDetail.init(),UserOpenHour.init(),UserFinance.init(),UserNotification.init(),OnlineBooking.init(),Sercurity.init(),ImageManager.init()});