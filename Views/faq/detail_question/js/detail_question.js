function get_thumbnail(e,a){var t=e.split("/"),n=t[t.length-1];t[t.length-1]="thumbnails/"+a;var i=n.split(".");i=i[0]+"_165x95.jpg",t[t.length]=i;var r=t.join("/");return r}$(document).ready(function(){Detail_Question.init()});var Detail_Question=function(){var e=$("#detail_question"),a=e.find(".faq_title"),t=e.find(".faq_content"),n=e.find(".faq_tag"),i=e.find(".faq_created"),r=e.find(".client_name"),s=e.find(".client_avatar"),c=e.find(".answer_count"),l=function(){var e=URL+"faq/xhrGet_question";$.get(e,{data_id:QUESTION_ID},function(e){if(0!=e){a.text(e.faq_title),t.text(e.faq_content);var l=JSON.parse(e.faq_tag);$.each(l,function(e,a){n.append('<a href="javascript:void(0)">'+a.text+"</a>, ")}),i.text(moment(e.faq_created,"YYYY-MM-DD HH:mm:ss").format("HH:mm, DD/MM/YYYY")),r.text(e.client_name),s.attr("src",URL+e.client_avatar),c.text(e.count_answer),_(l)}else window.location.href=URL+"faq"},"json").done(function(){})},_=function(e){var a=$("#service_related"),t='<div class="related-offer"><a href=":url_user" target="_blank"><div class="col-md-7 product-details"><p class="standalone-name">:user_service_name</p><small class="offer-location">:user_business_name, :user_address</small></div><div class="col-md-5 product-image" align="center"><p><img src=":user_service_image" width="100" height="68"/></p><strong class="price">:price đ</strong></div><div class="clearfix"></div><div class="discounted :discountExists" align="center"><div class="discount">:discount<span>%</span></div></div></a></div>',n=URL+"faq/xhrGet_service_related";$.get(n,{data_id:QUESTION_ID,tag_related:e},function(e){if(!jQuery.isEmptyObject(e)){var n=null,i=0,r=0,s="";$.each(e,function(e,c){n=c.user_service_image.split(","),n=n.length>0?get_thumbnail(n[0],c.user_id):"https://cdneu2.wahanda.net/images/view/v2.i291124.w100.h68.x14BC37F5",0==c.user_service_sale_price?(r=c.user_service_full_price,i=0):(r=c.user_service_sale_price,i=c.user_service_full_price-c.user_service_sale_price,i=i/c.user_service_full_price*100,i=Math.floor(i)),s=t.replace(":user_service_name",c.user_service_name),s=s.replace(":url_user",URL+"service/servicePlace/"+c.user_id+"#tab-services"),s=s.replace(":user_business_name",c.user_business_name),s=s.replace(":user_address",c.user_address),s=s.replace(":user_service_image",n),s=s.replace(":price",$.number(r)),s=s.replace(":discountExists",0==i?"hidden":""),s=s.replace(":discount",i),a.append(s)})}},"json")},o=function(){answer_form=$("#answer_form"),answer_form.on("submit",function(){var e=$(this),a=e.serializeArray();a.push({name:"faq_parent_id",value:QUESTION_ID});var t=!1,n=e.find(".loading"),i=e.find(".done");n.fadeIn(),i.hide();var r=URL+"faq/xhrInsert_answer_question";return $.post(r,a,function(e){"success"==e&&(t=!0)}).done(function(){n.hide(),i.show(),t?(alert("Câu trả lời của bạn đã được gửi đi thành công!"),location.reload()):alert("Thêm thất bại!")}),!1})},d=function(){var e='<!-- ANSWER --><div class="answer" id="answer-12554"><!-- ANSWER --><div class="answer-content"><div class="avatar pull-left"><a href="javascript:void(0)"><img width="50" height="50" alt="" src=":client_avatar" class="border img-circle"></a></div><div class="answer-content-container pull-left" ><p class="answerer"><a href="javascript:void(0)">:client_name</a> <small><i>:faq_created</i></small></p><p class="answer-body">:faq_content</p></div><div class="clearfix"></div></div> <!-- BUTTON COMMENT --><div class="user-actions"><div class="clearfix"><small> Câu trả lời hữu ích? </small> <span class="faq_like_:faq_id">:faq_like</span> <i class="fa fa-thumbs-up text-primary btnAct_like" data-like-id=":faq_id"></i><button class="btn btn-xs btn-primary pull-right btnAct_comment" data-answer-id=":faq_id"><span>Bình luận</span></button></div><div class="clearfix comment_box_:faq_id hidden"><br><form class="comment_form" action="#" method="POST"><input type="hidden" name="faq_parent_id" value=":faq_id" /><p><textarea class="form-control" name="faq_content" cols="50" placeHolder="Ít nhất 50 ký tự" pattern=".{50,}" required title="Ít nhất 50 ký tự"></textarea><p><button type="submit" class="btn btn-xs btn-primary pull-right btnA_comment"><span>Bình luận</span></button></form></div></div>  <!-- COMMENT --><div class="qanda-comments :exists_comment"><div class="col-xs-11 pull-right"><h4 class="answer-responses-heading">Bài bình luận</h4>:next_comment</div><div class="clearfix"></div></div></div><!-- END ANSWER -->',a='<!-- COMMENT --><div class="answer-response" id="answer-2501"><div class="avatar pull-left"><a href="javascript:void(0)"><img width="50" height="50" alt="" src=":client_avatar" class="border img-circle"></a></div><div class="answer-response-content pull-left"><p class="answerer"><a href="javascript:void(0)">:client_name</a> <small><i>:faq_created</i></small></p><p class="answer-response-body">:faq_content</p></div><div class="clearfix"></div></div>:next_comment',t=URL+"faq/xhrGet_list_answer";$.get(t,{data_id:QUESTION_ID},function(t){var n="",i=$("#top-answer"),r=$("#other-answer"),s=r.find(".answer_count");if(!jQuery.isEmptyObject(t.top_answer.faq_id)){if(n=e.replace(":client_avatar",null==t.top_answer.client_id?URL+"public/assets/img/default.png":URL+t.top_answer.client_avatar),n=n.replace(":client_name",null==t.top_answer.client_id?t.top_answer.faq_author:t.top_answer.client_name),n=n.replace(":faq_created",t.top_answer.faq_created),n=n.replace(":faq_content",t.top_answer.faq_content),n=n.replace(":faq_like",t.top_answer.faq_like),n=n.replace(/:faq_id/g,t.top_answer.faq_id),jQuery.isEmptyObject(t.top_answer.answers))n=n.replace(":exists_comment","hidden"),n=n.replace(":next_comment","");else{var c=t.top_answer.answers;n=n.replace(":exists_comment",""),$.each(c,function(e,t){n=n.replace(":next_comment",a),n=n.replace(":client_avatar",URL+t.client_avatar),n=n.replace(":client_name",t.client_name),n=n.replace(":faq_created",t.faq_created),n=n.replace(":faq_content",t.faq_content)}),n=n.replace(":next_comment","")}i.append(n)}jQuery.isEmptyObject(t.other_answer)?s.text(0):($.each(t.other_answer,function(t,i){if(n=e.replace(":client_avatar",null==i.client_id?URL+"public/assets/img/default.png":URL+i.client_avatar),n=n.replace(":client_name",null==i.client_id?i.faq_author:i.client_name),n=n.replace(":faq_created",i.faq_created),n=n.replace(":faq_content",i.faq_content),n=n.replace(":faq_like",i.faq_like),n=n.replace(/:faq_id/g,i.faq_id),jQuery.isEmptyObject(i.answers))n=n.replace(":exists_comment","hidden"),n=n.replace(":next_comment","");else{var s=i.answers;n=n.replace(":exists_comment",""),$.each(s,function(e,t){n=n.replace(":next_comment",a),n=n.replace(":client_avatar",URL+t.client_avatar),n=n.replace(":client_name",t.client_name),n=n.replace(":faq_created",t.faq_created),n=n.replace(":faq_content",t.faq_content)}),n=n.replace(":next_comment","")}r.append(n)}),s.text(t.other_answer.length)),f(),p()},"json").done(function(){$(".btnAct_comment").on("click",function(){var e=$(this),a=e.attr("data-answer-id"),t=URL+"faq/xhrCheck_login";$.get(t,function(e){1==e?$(".comment_box_"+a).removeClass("hidden"):$("#login_modal").modal("show")})})})},f=function(){$(".comment_form").on("submit",function(){var e=$(this),a=e.serializeArray(),t=!1,n=e.find(".loading"),i=e.find(".done");n.fadeIn(),i.hide();var r=URL+"faq/xhrInsert_comment_answer";return $.post(r,a,function(e){"success"==e&&(t=!0)}).done(function(){n.hide(),i.show(),t?(alert("Câu trả lời đã được gửi thành công!"),location.reload()):alert("Thêm thất bại!")}),!1})},p=function(){$(".btnAct_like").on("click",function(){var e=$(this),a=e.attr("data-like-id"),t={faq_id:a},n=!1,i=e.find(".loading"),r=e.find(".done");i.fadeIn(),r.hide();var s=URL+"faq/xhrUpdate_like";$.post(s,t,function(t){if("success"==t){var i=$(".faq_like_"+a);i.text(parseInt(i.text())+1),n=!0}"liked"==t&&(e.text(" Đã thích"),n=!0)}).done(function(){i.hide(),r.show(),n||alert("like error!")})})};return{init:function(){l(),o(),d(),f()}}}();